---
title: "Pauta Tarea 3"
author: Gabriel Cabrera 
output:
  html_document:
    theme: "cosmo"
    highlight: "kate"
    toc: true
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: true
    number_sections: true
    code_folding: "show"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

---

1.	Esta tarea debe ser entregada en grupos de máximo 3 personas. 
2.	Se debe enviar una carpeta comprimida que contenga: un archivo .Rproj (proyecto en R), un script y un breve informe en R Markdown con sus resultados, incluyendo tablas, gráficos, etc., según corresponda.  El formato del infome puede ser word o pdf y se debe \textbf{incluir} el archivo Rmd.
3.  El nombre del archivo comprimido debe ser "Tarea 3-R-Uchile Apellido 1-Apellido 2-Apellido 3".
4.  El asunto del email con su tarea debe ser "Tarea 3-R-Uchile Apellido 1-Apellido 2-Apellido 3".
5.	La fecha de entrega es el Sábado 13 de Octubre del 2018 hasta las 23:59 hrs al correo del curso:                      [r2018uchile@gmail.com](r2018uchile@gmail.com). 

---

> “The goal is to turn data into information, and information into insight” 
> Carly Fiorina, CEO de HP desde 1999 hasta 2005


```{r}
if(!require("pacman")) install.packages("pacman")
p_load("tidyverse", "maps", "lubridate", "plotly")
```

# Pregunta 1 {.tabset - .tabset-fade}

## Pregunta 1.1 {-}

Usted en la Tarea 1 (pregunta 1.5) tuvo que identificar el porcentaje de películas estrenadas por década. A partir del *data frame* obtenido, construya un *pie chart* usando la librería *plotly*. (*20 puntos*)

```{r, eval = TRUE, echo = TRUE}
movie_dataset <- read.csv("Datasets/movie_dataset.csv")

# porcentaje de peliculas por decada 
decade_movies <- movie_dataset %>% 
                 na.omit() %>% 
                 mutate(year = year(release_date), decade = year - year%%10, n = n()) %>% 
                 group_by(decade, n) %>% 
                 summarise(n()) %>% 
                 mutate(percentage = `n()`/n)
```

```{r}
p <- plot_ly(decade_movies, labels = ~ decade, values = ~percentage, type = "pie") %>%
         layout(title = "Porcentaje de películas por década",
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE))
p
```


## Pregunta 1.2 {-}

Considerando la Tarea 1 (pregunta 1.6), indentifique el presupuesto promedio (*budget*) por estado y presentelo esta vez utilizando el mapa de los Estados Unidos.  (*20 puntos*)

```{r}
# cargamos la lista y la transformas a character
lista_estados <- read.csv("Datasets/estados.csv") %>% 
                 as.matrix() %>% 
                 as.character()
```

```{r, eval = TRUE, echo = TRUE}
# Promedio de presupuesto por estado de Estados Unidos
keywords <- read.csv("Datasets/keywords.csv")

peliculas_estado <- keywords %>%                                 
                    filter(keywords %in% lista_estados) %>%
                    right_join(movie_dataset, by = "id") %>% 
                    group_by(keywords) %>%                   
                    summarise(count=n(), mean(budget)) %>%                
                    mutate(nombre_estado=keywords) %>%       
                    right_join(                             
                      tibble(nombre_estado=lista_estados),  
                      by="nombre_estado"                    
                    ) %>%                                 
                    select(nombre_estado, count, `mean(budget)`) %>%        
                    mutate(
                      count=ifelse(is.na(count),0,count)    
                    ) %>%
                    rename("presupuesto" = `mean(budget)`) %>% 
                    arrange(desc(count))   
```
```{r}
mapa_estados <- map_data("state")  
```

```{r}
g1 <- ggplot(peliculas_estado) + 
      geom_map(aes(map_id = nombre_estado, fill = presupuesto), map = mapa_estados) + 
      expand_limits(x = mapa_estados$long, y = mapa_estados$lat) +
      labs(title ="Presupuesto promedio por Estados", subtitle = "Estados Unidos") + xlab("Longitud") + ylab("Latitud") +
      theme_bw()
g1
```


# Pregunta 2 {.tabset -} 

A partir de las variables seleccionadas del *World Development Indicators* de su Tarea 2, represente en un mapa los valores que asume cada variable en 1990 y 2015.


# Pregunta 3 {.tabset -} 

Visite el sitio web [http://datos.gob.cl/](http://datos.gob.cl/) y descargue una base de datos de su preferencia^[Debe contener las comunas de la región Metropolitana.], justificando su elección. Luego, represente los datos seleccionados en un mapa de una o varias de las comunas de la región Metropolitana. Los mapas vectoriales pueden ser descargados de [https://www.bcn.cl](https://www.bcn.cl/siit/mapas_vectoriales).